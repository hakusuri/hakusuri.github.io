<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/blog_icon_194621.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/blog_icon_194621-16x6.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":"enable","show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="网络层概述1、主要任务：实现网络互联，进而实现数据包在各个网络之间的传输。 2、实现网络层需要解决的问题：     a、网络层需向运输层提供什么样的服务：可靠传输还是不可靠传输；     b、网络层寻址问题：如何标识和寻找网络上的主机(接口)；     c、路由选择问题：源站选择怎样的路径到达目的站。 3、因特网(Internet)是目前全世界用户数量最多的互联网，它使用TCP&#x2F;IP协议栈。 4、">
<meta property="og:type" content="article">
<meta property="og:title" content="网络层">
<meta property="og:url" content="http://example.com/2025/02/22/%E7%BD%91%E7%BB%9C%E5%B1%82/index.html">
<meta property="og:site_name" content="HakusuriのBlog">
<meta property="og:description" content="网络层概述1、主要任务：实现网络互联，进而实现数据包在各个网络之间的传输。 2、实现网络层需要解决的问题：     a、网络层需向运输层提供什么样的服务：可靠传输还是不可靠传输；     b、网络层寻址问题：如何标识和寻找网络上的主机(接口)；     c、路由选择问题：源站选择怎样的路径到达目的站。 3、因特网(Internet)是目前全世界用户数量最多的互联网，它使用TCP&#x2F;IP协议栈。 4、">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/QQ20250212-142306.png">
<meta property="og:image" content="http://example.com/images/QQ20250212-162621.png">
<meta property="og:image" content="http://example.com/images/QQ20250212-184505.png">
<meta property="og:image" content="http://example.com/images/QQ20250215-221019.png">
<meta property="og:image" content="http://example.com/images/QQ20250215-221221.png">
<meta property="og:image" content="http://example.com/images/QQ20250216-143930.png">
<meta property="article:published_time" content="2025-02-22T09:41:37.000Z">
<meta property="article:modified_time" content="2025-02-22T09:45:19.995Z">
<meta property="article:author" content="hakusuri">
<meta property="article:tag" content="计算机网络">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/QQ20250212-142306.png">

<link rel="canonical" href="http://example.com/2025/02/22/%E7%BD%91%E7%BB%9C%E5%B1%82/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>网络层 | HakusuriのBlog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="HakusuriのBlog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HakusuriのBlog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="far fa-save fa-fw"></i>资源</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/22/%E7%BD%91%E7%BB%9C%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hakusuri">
      <meta itemprop="description" content="Hakusuri的个人生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HakusuriのBlog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          网络层
        </h1>

        <div class="post-meta">
	  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-22 17:41:37 / 修改时间：17:45:19" itemprop="dateCreated datePublished" datetime="2025-02-22T17:41:37+08:00">2025-02-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learning-Notes/" itemprop="url" rel="index"><span itemprop="name">Learning Notes</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>14 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a><center>网络层</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><pre><code>1、主要任务：实现网络互联，进而实现数据包在各个网络之间的传输。
2、实现网络层需要解决的问题：
    a、网络层需向运输层提供什么样的服务：可靠传输还是不可靠传输；
    b、网络层寻址问题：如何标识和寻找网络上的主机(接口)；
    c、路由选择问题：源站选择怎样的路径到达目的站。
3、因特网(Internet)是目前全世界用户数量最多的互联网，它使用TCP/IP协议栈。
4、由于TCP/IP协议栈的网络层使用网际协议IP，它是整个协议栈的核心协议，因此在TCP/IP协议栈中网络层常称为网际层
</code></pre>
<span id="more"></span>

<h2 id="网络层提供的两种类型服务"><a href="#网络层提供的两种类型服务" class="headerlink" title="网络层提供的两种类型服务"></a>网络层提供的两种类型服务</h2><h4 id="1、面向连接的虚电路服务："><a href="#1、面向连接的虚电路服务：" class="headerlink" title="1、面向连接的虚电路服务："></a>1、面向连接的虚电路服务：</h4><pre><code>a、可靠通信由网络来保证。
b、必须建立网络层的连接——虚电路VC(Virtual Circuit)。虚电路是一条逻辑上的连接，分组在这条逻辑电路上按照存储转发的方式传送。而采用电路交换的电话通信则是先建立一条真正的连接。
c、通信双方沿着已建立的虚电路发送分组。
d、目的主机的地址仅在连接建立阶段使用，之后每个分组的首部只需携带一条虚电路的编号即可进行通信(构成虚电路的每一段链路都有一个虚电路编号)。
e、这种通信方式如果再使用可靠传输的网络协议，就可使所发送的分组最终正确到达接收方(无差错按序到达、不丢失、不重复)。
f、通信结束后，需要释放之前所建立的虚电路。
g、很多广域分组交换网都使用面向连接的虚电路服务，例如，曾经的X.25和逐渐过时的帧中继FR、异步传输模式ATM等。
</code></pre>
<h4 id="2、无连接的数据报服务："><a href="#2、无连接的数据报服务：" class="headerlink" title="2、无连接的数据报服务："></a>2、无连接的数据报服务：</h4><pre><code>a、可靠通信应当由用户主机来保证。
b、不需要建立网络层连接。
c、每个分组可走不同的路径。
d、每个分组的首部必须携带目的主机的完整地址。
e、这种通信方式所传送的分组可能误码、丢失、重复和失序。
f、由于网络本身不提供端到端的可靠传输服务，这就使网络中的路由器可以做得比较简单，而且价格低廉(与电信网的交换机相比较)
g、因特网采用了这种设计思想，也就是将复杂的网络处理功能置于因特网的边缘(用户主机和其内部的运输层)，而将相对简单的尽最大努力的分组交付功能置于因特网核心。
</code></pre>
<h4 id="3、两种服务的比较"><a href="#3、两种服务的比较" class="headerlink" title="3、两种服务的比较"></a>3、两种服务的比较</h4><p><img src="/images/QQ20250212-142306.png" alt="网络层的两种服务比较"></p>
<h2 id="IPv4-地址"><a href="#IPv4-地址" class="headerlink" title="IPv4 地址"></a>IPv4 地址</h2><h4 id="1、概述："><a href="#1、概述：" class="headerlink" title="1、概述："></a>1、概述：</h4><pre><code>a、IPv4地址就是给因特网(Internet)上的每一台主机(或路由器)的每一个接口分配一个在全世界范围内是唯一的32比特的标识符。
b、IP地址由因特网名字和数字分配机构ICANN(Internet Corporation for Assigned Names and Numbers)进行分配：
    (1)我国用户可向亚太网络信息中心APNIC(Asia Pacific Network Information Center)申请IP地址，需要缴费。
    (2)2011年2月3日，互联网号码分配管理局IANA(由ICANN行使职能)宣布，IPv4地址已经分配完毕。
    (3)我国在2014至2015年也逐步停止了向新用户和应用分配IPv4地址。同时全面开展商用部署IPv6。
c、IPv4地址的编址方法经历了三个历史阶段：
    (1)1981：分类编址
    (2)1985：划分子网
    (3)1993：无分类编址
d、IPv4地址常采用点分十进制表示方法，即每8个bit位变为一个十进制数，共四个十进制数，每个数之间用点隔开。
</code></pre>
<h4 id="2、分类编址的-IPv4-地址"><a href="#2、分类编址的-IPv4-地址" class="headerlink" title="2、分类编址的 IPv4 地址"></a>2、分类编址的 IPv4 地址</h4><pre><code>a、A类地址前8位为网络号，后24位为主机号，网络号的最高一位固定为0；
   B类地址前16位为网络号，后16位为主机号，网络号的最高两位固定为10；
   C类地址前24位为网络号，后8位为主机号，网络号的最高三位固定为110；
   D类地址为多播地址，最高四位固定为1110；
   E类地址保留为今后使用，最高四位固定为1111。
b、只有A类、B类和C类地址可分配给网络中的主机或路由器的各接口；
c、主机号为“全0”的地址是网络地址，不能分配给主机或路由器的各接口；主机号为“全1”的地址是广播地址，不能分配给主机或路由器的各接口。
</code></pre>
<h5 id="1-A-类地址："><a href="#1-A-类地址：" class="headerlink" title="(1)A 类地址："></a>(1)A 类地址：</h5><pre><code>1、A类地址最小网络号为0(00000000)，被保留不做指派；
2、第一个可指派的网络号为1(00000001)，网络地址为1.0.0.0；
3、最大网络号为127(01111111),作为本地回环测试地址，不做指派：
    最小的本地回环测试地址为127.0.0.1；
    最大的本地回环测试地址为127.255.255.254。
4、最后一个可指派的网络号为126(01111110)，网络地址为126.0.0.0；
5、可指派的网络数量为2^(8-1)-2=126个(除去小网络号0和最大网络号127)，每个网络中可分配的IP地址数量为2^24-2=16777214个(除去全0的网络地址和全1的广播地址)。
6、A类地址的第一个十进制数的范围为0~127。
</code></pre>
<h5 id="2-B-类地址："><a href="#2-B-类地址：" class="headerlink" title="(2)B 类地址："></a>(2)B 类地址：</h5><pre><code>1、B类地址最小网络号也是第一个可指派的网络号为128.0(10000000.00000000)，网络地址为128.0.0.0；
2、最大网络号也是最后一个可指派的网络号为191.255(10111111.11111111)，网络地址为191.255.0.0；
3、可指派的网络数量为2^(16-2)=16384个；每个网络中可分配的IP地址数量为2^16-2=65534个。
4、B类地址的第一个十进制数的范围为128~191。
</code></pre>
<h5 id="3-C-类地址："><a href="#3-C-类地址：" class="headerlink" title="(3)C 类地址："></a>(3)C 类地址：</h5><pre><code>1、C类地址最小网络号也是第一个可指派的网络号为192.0.0(11000000.00000000.00000000),网络地址为192.0.0.0；
2、最大网络号也是最后一个可指派的网络号为223.255.255(11011111.11111111.11111111)，网络地址为223.255.255.0；
3、可指派的网络数量为2^(24-3)=2097152个；每个网络中可分配的IP地址数量为2^8-2=254个。
4、C类地址的第一个十进制数的范围为192~223。
</code></pre>
<h5 id="4-特殊-IP-地址："><a href="#4-特殊-IP-地址：" class="headerlink" title="(4)特殊 IP 地址："></a>(4)特殊 IP 地址：</h5><pre><code>1、地址0.0.0.0是一个特殊的IPv4地址，只能作为源地址使用，表示“在本网络上的本主机”
封装有DHCP Discovery报文的IP分组的源地址使用0.0.0.0;
2、以127开头且后面三个字节非“全0”或“全1”的IP地址是一类特殊的IPv4地址，既可以作为源地址使用也可以作为目的地址使用，用于本地软件环回测试，例如常用的环回测试地址127.0.0.1；
3、地址255.255.255.255是一个特殊的IPv4地址，只能作为目的地址使用，表示“只在本网络上进行广播(各路由器均不转发)”
</code></pre>
<p><img src="/images/QQ20250212-162621.png" alt="特殊IP地址"></p>
<h4 id="3、划分子网的-Ipv4-地址：通过借用分类-IP-地址的一些主机位来作为子网位，将一个大的网络地址划分为多个子网，二级结构的分类-IP-地址-网络号-主机号-变为三级结构的划分子网-IP-地址-网络号-子网号-主机号-。"><a href="#3、划分子网的-Ipv4-地址：通过借用分类-IP-地址的一些主机位来作为子网位，将一个大的网络地址划分为多个子网，二级结构的分类-IP-地址-网络号-主机号-变为三级结构的划分子网-IP-地址-网络号-子网号-主机号-。" class="headerlink" title="3、划分子网的 Ipv4 地址：通过借用分类 IP 地址的一些主机位来作为子网位，将一个大的网络地址划分为多个子网，二级结构的分类 IP 地址(网络号-主机号)变为三级结构的划分子网 IP 地址(网络号-子网号-主机号)。"></a>3、划分子网的 Ipv4 地址：通过借用分类 IP 地址的一些主机位来作为子网位，将一个大的网络地址划分为多个子网，二级结构的分类 IP 地址(网络号-主机号)变为三级结构的划分子网 IP 地址(网络号-子网号-主机号)。</h4><h5 id="a、子网掩码：32bit-的子网掩码可用表明分类-IP-地址的主机号部分被借用了几个比特作为子网号。"><a href="#a、子网掩码：32bit-的子网掩码可用表明分类-IP-地址的主机号部分被借用了几个比特作为子网号。" class="headerlink" title="a、子网掩码：32bit 的子网掩码可用表明分类 IP 地址的主机号部分被借用了几个比特作为子网号。"></a>a、子网掩码：32bit 的子网掩码可用表明分类 IP 地址的主机号部分被借用了几个比特作为子网号。</h5><pre><code>1、子网掩码使用连续的比特1来对应网络号和子网号；
2、子网掩码使用连续的比特0来对应主机号；
3、将划分子网的IPv4地址与其相应的子网掩码进行逻辑与运算就可得到该IPv4地址所在子网的网络地址。
</code></pre>
<h5 id="b、默认子网掩码：指在未划分子网的情况下使用的子网掩码。"><a href="#b、默认子网掩码：指在未划分子网的情况下使用的子网掩码。" class="headerlink" title="b、默认子网掩码：指在未划分子网的情况下使用的子网掩码。"></a>b、默认子网掩码：指在未划分子网的情况下使用的子网掩码。</h5><pre><code>A类地址的默认子网掩码为255.0.0.0；
B类地址的默认子网掩码为255.255.0.0；
C类地址的默认子网掩码为255.255.255.0。
</code></pre>
<h4 id="4、无分类编址的-IPv4-地址：将-32bit-分为网络前缀和主机编号，网络前缀的-bit-数写在“-”后面。"><a href="#4、无分类编址的-IPv4-地址：将-32bit-分为网络前缀和主机编号，网络前缀的-bit-数写在“-”后面。" class="headerlink" title="4、无分类编址的 IPv4 地址：将 32bit 分为网络前缀和主机编号，网络前缀的 bit 数写在“&#x2F;”后面。"></a>4、无分类编址的 IPv4 地址：将 32bit 分为网络前缀和主机编号，网络前缀的 bit 数写在“&#x2F;”后面。</h4><pre><code>a、1993年，IETF发布了无分类域间路由选择CIDR(Classless Inter-Domain Routing)的RFC文档:RFC 1517~1519和1520：
    CIDR消除了传统的A类、B类和C类地址，以及划分子网的概念；
    CIDR可以更加有效地分配IPv4的地址空间，并且可以在新的IPv6使用之前允许因特网
    的规模继续增长。
b、CIDR使用“斜线记法”或称CIDR记法。即在IPv4地址后面加上斜线“/”，在斜线后面写上网络前缀所占的比特数量。
c、CIDR实际上是将网络前缀都相同的连续的IP地址组成一个“CIDR地址块。
d、我们只要知道CIDR地址块中的任何一个地址，就可以知道该地址块的全部细节，地址快的大小由网络前缀的bit位数决定:
    地址块的最小地址：即主机号全0；
    地址块的最大地址：即主机号全1；
    地址块中的地址数量：即主机号的数量，2^主机号位数；
    地址块聚合某类网络(A类、B类或C类)的数量：地址数量/某类网络的主机数
    地址掩码(也可继续称为子网掩码)：网络前缀对应的掩码为1，主机号对应的掩码为0。
e、路由聚合(构造超网)：将同一个路由连接的多个网络，寻找其有相同的前缀作为网络前缀，其相同前缀的位数作为网络前缀的位数，其余位取0，形成聚合地址快。
f、路由聚合解决了路由表的内容冗余问题，使用路由聚合能够缩小路由表的规模，减少路由表的内存。
g、路由聚合的网络前缀越长，地址块越小，路由越具体;若路由器查表转发分组时发现有多条路由可选，则选择网络前最长的那条，这称为最长前缀匹配，因为这样的路由更具体。
</code></pre>
<h4 id="5、IPv4-地址的应用规划："><a href="#5、IPv4-地址的应用规划：" class="headerlink" title="5、IPv4 地址的应用规划："></a>5、IPv4 地址的应用规划：</h4><pre><code>a、定长的子网掩码FLSM(Fixed Length Subnet Mask)：使用长度固定的同一个子网掩码划分子网。
b、变长的子网掩码VLSM(Variable Length Subnet Mask)：使用长度不定的不同掩码划分子网。
c、变长子网掩码分配原则：每个子块的起点位置不能随意选取，只能选取块大小整数倍的地址作为“起点”。建议先给大的子块分配。
</code></pre>
<p><img src="/images/QQ20250212-184505.png" alt="不同的子网划分"></p>
<h2 id="IP-数据报的发送和转发过程"><a href="#IP-数据报的发送和转发过程" class="headerlink" title="IP 数据报的发送和转发过程"></a>IP 数据报的发送和转发过程</h2><h4 id="1、IP-数据报的发送和转发过程包含以下两部分"><a href="#1、IP-数据报的发送和转发过程包含以下两部分" class="headerlink" title="1、IP 数据报的发送和转发过程包含以下两部分:"></a>1、IP 数据报的发送和转发过程包含以下两部分:</h4><pre><code>a、主机发送IP数据报
b、路由器转发IP数据报
</code></pre>
<h4 id="2、数据报交付的分类："><a href="#2、数据报交付的分类：" class="headerlink" title="2、数据报交付的分类："></a>2、数据报交付的分类：</h4><pre><code>a、同一个网络之间的主机：可直接通信，属于直接交付；
b、不同网络之间的主机：数据报需要通过路由器中转，属于间接交付。
</code></pre>
<h4 id="3、源主机判断目的主机是否和自身在同一个网络："><a href="#3、源主机判断目的主机是否和自身在同一个网络：" class="headerlink" title="3、源主机判断目的主机是否和自身在同一个网络："></a>3、源主机判断目的主机是否和自身在同一个网络：</h4><pre><code>a、将自身IP地址与子网掩码相与，获得自身所在网络的网络地址；
b、将目的主机IP地址与自身子网掩码相与，获得目的主机的网络地址；
c、通过对比自身网络的网络地址和目的主机的网络地址可知是否在同一个网络中。
</code></pre>
<h4 id="4、默认网关：与某局域网直接相连的路由器接口-IP-地址，该局域网内的主机将该接口的-IP-地址作为默认网关。"><a href="#4、默认网关：与某局域网直接相连的路由器接口-IP-地址，该局域网内的主机将该接口的-IP-地址作为默认网关。" class="headerlink" title="4、默认网关：与某局域网直接相连的路由器接口 IP 地址，该局域网内的主机将该接口的 IP 地址作为默认网关。"></a>4、默认网关：与某局域网直接相连的路由器接口 IP 地址，该局域网内的主机将该接口的 IP 地址作为默认网关。</h4><pre><code>局域网内的主机与外部网络中的主机通信时，会将IP数据报传输给默认网关，由默认网关也就是路由器帮主机将IP数据报转发出去。
</code></pre>
<h4 id="5、路由器转发数据报过程："><a href="#5、路由器转发数据报过程：" class="headerlink" title="5、路由器转发数据报过程："></a>5、路由器转发数据报过程：</h4><pre><code>a、检查IP数据报首部是否出错：若出错，则直接丢弃该IP数据报并通告源主机；若没有出错，则进行转发。
b、根据IP数据报的目的地址在路由表中查找匹配的条目：若找到匹配的条目，则转发给条目中指示的下一跳；若找不到，则丢弃该IP数据报并通告源主机。
c、路由表(目的网络-地址掩码-下一跳地址)：路由器转发时将IP数据报首部的目的地址逐条与地址掩码相与，看其是否与对应的目的网络的地址匹配，若相同则根据下一跳地址进行转发。
</code></pre>
<h4 id="6、"><a href="#6、" class="headerlink" title="6、"></a>6、</h4><pre><code>a、IP 路由器工作在 TCP/IP 体系结构的网际层(或称 IP 层)，TCP/IP 体系结构的网际层并不负责可靠传输，也就是不能确保传输的 IP 分组不丢失。
b、IP 路由器对收到的 IP 分组头进行差错校验，当发现错误时会丢奔该 IP 分组并向源主机发送 ICMP 差错报告报文(类型为参数错误)。
c、路由器既隔离冲突域又隔离广播域，无论是针对自身网络的广播帧还是针对其他网络的广播帧，路由器均不会进行转发。
</code></pre>
<h2 id="静态路由配置"><a href="#静态路由配置" class="headerlink" title="静态路由配置"></a>静态路由配置</h2><pre><code>a、静态路由配置是指用户或网络管理员使用路由器的相关命令给路由器人工配置路由表：
    (1)这种人工配置方式简单、开销小。但不能及时适应网络状态(流量、拓扑等)的变化。
    (2)一般只在小规模网络中采用。
b、使用静态路由配置可能出现以下导致产生路由环路的错误：
    (1)配置错误
    (2)聚合了不存在的网络
    (3)网络故障
c、路由条目类型：
    (1)直连：目的网络地址与路由器直接相连；
    (2)静态：人工配置的静态路由；
    (3)动态：根据相关协议自动学习。
</code></pre>
<h4 id="1、默认路由：是一种特殊的静态路由，当路由表中的条目与数据包目的地址没有匹配的表项时，数据包将根据默认路由条目进行转发。"><a href="#1、默认路由：是一种特殊的静态路由，当路由表中的条目与数据包目的地址没有匹配的表项时，数据包将根据默认路由条目进行转发。" class="headerlink" title="1、默认路由：是一种特殊的静态路由，当路由表中的条目与数据包目的地址没有匹配的表项时，数据包将根据默认路由条目进行转发。"></a>1、默认路由：是一种特殊的静态路由，当路由表中的条目与数据包目的地址没有匹配的表项时，数据包将根据默认路由条目进行转发。</h4><pre><code>a、默认路由在某些时候是非常有效的，例如在末梢网络中，默认路由可以大大简化路由器的配置，减轻网络管理员的工作负担。
b、默认路由条目的目的网络为0.0.0.0/0，可作为小型网络进入因特网的入口。
c、默认路由的网络前缀最短，路由最模糊。
</code></pre>
<h4 id="2、特定主机路由：对特定的目的主机指明一个静态路由条目。"><a href="#2、特定主机路由：对特定的目的主机指明一个静态路由条目。" class="headerlink" title="2、特定主机路由：对特定的目的主机指明一个静态路由条目。"></a>2、特定主机路由：对特定的目的主机指明一个静态路由条目。</h4><pre><code>a、采用特定主机路由可使网络管理人员能够更方便地控制网络和测试网络，同时也可在需要考虑某种安全问题时采用这种特定主机路由。
b、特定主机路由的网络前缀最长，路由最具体。
</code></pre>
<h4 id="3、最长前缀匹配：当路由器收到一个-IP-数据包时，它会将数据包的目的-IP-地址与自己本地路由表中的所有路由表进行逐位（Bit-By-Bit）对比，直到找到匹配度最长的条目进行转发。"><a href="#3、最长前缀匹配：当路由器收到一个-IP-数据包时，它会将数据包的目的-IP-地址与自己本地路由表中的所有路由表进行逐位（Bit-By-Bit）对比，直到找到匹配度最长的条目进行转发。" class="headerlink" title="3、最长前缀匹配：当路由器收到一个 IP 数据包时，它会将数据包的目的 IP 地址与自己本地路由表中的所有路由表进行逐位（Bit-By-Bit）对比，直到找到匹配度最长的条目进行转发。"></a>3、最长前缀匹配：当路由器收到一个 IP 数据包时，它会将数据包的目的 IP 地址与自己本地路由表中的所有路由表进行逐位（Bit-By-Bit）对比，直到找到匹配度最长的条目进行转发。</h4><h4 id="4、路由环路问题："><a href="#4、路由环路问题：" class="headerlink" title="4、路由环路问题："></a>4、路由环路问题：</h4><pre><code>a、配置错误：配置静态路由时错误地将下一跳地址配置为先前路径上的路由，从而形成环路，使数据包在网络中不断转发。
    解决：为了防止IP数据报在路由环路中永久兜圈，在IP数据报首部设有生存时间TTL字段。IP数据报进入路由器后，TTL字段的值减1。若TTL的值不等于0，则被路由器转发，否则被丢弃。
b、聚合不存在的网络：数据包的目的地址为某一聚合地址中不存在的网络，错误地被路由器转发，而下一个路由器的路由表中没有该目的地址，被转发至默认路由，形成环路。
    解决：在相应路由器的路由表中添加针对聚合网络中不存在网络的黑洞路由。
c、黑洞路由：为静态路由，黑洞路由的下一跳为null0，为路由器内部的虚拟接口，转发至该接口即丢弃数据报。
d、网络故障：若路由器检测到某接口直连的网络不可达，就会自动在其路由表中删除相关路由条目，致使发往该网络的数据报因为查找不到路由条目而转发至默认路由，形成回路。
    解决：在某网络发生故障时，在直连的路由器中添加针对该网络的黑洞路由。若一段时间故障解决，路由器自动添加相关条目并将人工配置的黑洞路由条目置为失效状态。若再次检测到故障，则自动删除直连网络的路由条目，再次启动黑洞路由条目。
</code></pre>
<h2 id="路由选择协议"><a href="#路由选择协议" class="headerlink" title="路由选择协议"></a>路由选择协议</h2><h4 id="1、路由选择分类："><a href="#1、路由选择分类：" class="headerlink" title="1、路由选择分类："></a>1、路由选择分类：</h4><pre><code>a、静态路由选择：
    (1)由人工配置的网络路由、默认路由、特定主机路由、黑洞路由等都属于静态路由。
    (2)这种人工配置方式简单、开销小。但不能及时适应网络状态(流量、拓扑等)的变化
    (3)一般只在小规模网络中采用。
b、动态路由选择：
    (1)路由器通过路由选择协议自动获取路由信息。
    (2)比较复杂、开销比较大。能较好地适应网络状态的变化。
    (3)适用于大规模网络。
</code></pre>
<h4 id="2、因特网采用的路由选择协议特点："><a href="#2、因特网采用的路由选择协议特点：" class="headerlink" title="2、因特网采用的路由选择协议特点："></a>2、因特网采用的路由选择协议特点：</h4><pre><code>a、自适应：采用动态路由选择，能较好地适应网络状态的变化。
b、分布式：因特网中的各路由器通过相互间的信息交互即交换路由信息，共同完成路由信息的获取和更新。
c、分层次：将整个因特网划分为许多较小的自治系统AS(Autonomous System)。如将一个较大的因特网服务供应商ISP就可划为一个自治系统。自治系统内部和外部采用不同的路由选择协议，分别进行路由选择。
</code></pre>
<h4 id="3、常见的路由选择协议："><a href="#3、常见的路由选择协议：" class="headerlink" title="3、常见的路由选择协议："></a>3、常见的路由选择协议：</h4><pre><code>a、内部网关协议IGP(内部路由协议IRP)：自治系统内部选择的路由协议(域内路由选择)，与其他自治系统选择何种协议无关。
    (1)路由信息协议RIP：基于距离向量，在因特网上最早使用；
    (2)内部网关路由协议IGRP：基于距离向量，IGRP是思科早期私有的协议，现在已被EIGRP取代；
    (3)增强型内部网关路由协议EIGRP：思科私有的，用来取代IGRP的混合型路由协议(结合距离向量和链路状态)；
    (4)开放式最短路径优先OSPF：基于链路状态，OSPF在各种网络中广泛使用；
    (5)中间系统到中间系统IS-IS：基于链路状态，集成化IS-IS是ISP骨干网上最长常用的IGP协议。
b、外部网关协议EGP(外部路由协议ERP)：自治系统之间的路由选择(域间路由选择)。边界网关协议BGP。
</code></pre>
<h4 id="4、路由器基本结构：具有多个输入端口和输出端口的专用计算机，其任务为转发分组。"><a href="#4、路由器基本结构：具有多个输入端口和输出端口的专用计算机，其任务为转发分组。" class="headerlink" title="4、路由器基本结构：具有多个输入端口和输出端口的专用计算机，其任务为转发分组。"></a>4、路由器基本结构：具有多个输入端口和输出端口的专用计算机，其任务为转发分组。</h4><pre><code>a、路由选择部分：其核心为路由选择处理机，根据所使用路由选择协议，周期性地与其他路由器交换路由信息，更新路由表。
b、分组转发部分：
    (1)交换结构：若收到的分组为普通待转发数据分组，则根据分组首部的目的地址进行查表转发(交换结构中的表为转发表)，若找不到匹配转发条目则丢弃分组；若收到的分组为路由器之间交换路由信息的路由报文，则将该分组送往路由选择处理机，路由选择处理机根据分组内容更新自己的路由表，进而更新交换结构的转发表。
    (2)输入端口：输入端口的物理层将收到的信号转换为比特流，交付链路层；链路层识别出帧，去掉帧头帧尾交付网络层；网络层收到分组交给交换结构。
    (3)输出端口：输出端口收到交换结构的待转发分组，其网络层更新分组首部某些字段的值(如生存时间-1),交给链路层封装成帧，后物理层将其视为比特流转变为相应的电信号发送。
    (4)输入缓冲区：暂存新进入路由器但来不及处理的分组。
    (5)输出缓冲区：暂存已处理完毕但来不及发送的分组。
c、路由表和转发表：路由表一般仅包含从目的网络到下一跳的映射，路由表需要对网络拓扑变化的计算最优化；转发表是从路由表得出的，转发表的结构应当使查找过程最优化。
</code></pre>
<h2 id="路由信息协议-RIP"><a href="#路由信息协议-RIP" class="headerlink" title="路由信息协议 RIP"></a>路由信息协议 RIP</h2><pre><code>a、路由信息协议RIP(Routing Infomation Protoco)是内部网关协议IGP中最先得到广泛使用的协议之一，其相关标准文档为RFC 1058。
b、RIP要求自治系统AS内的每一个路由器都要维护从它自己到AS内其他每一个网络的距离记录。这是一组距离，称为“距离向量D-V(Distance-Vector)”。
c、RIP使用跳数(Hop Count)作为度量(Metric)来衡量到达目的网络的距离。
    (1)路由器到直连网络的距离定义为1.
    (2)路由器到非直连网络的距离定义为所经过的路由器数加1.
    (3)允许一条路径最多只能包含15个路由器。“距离”等于16时相当于不可达。因此，RIP只适用于小型互联网。
d、RIP认为好的路由就是“距离短”的路由，也就是所通过路由器数量最少的路由。当到达同一目的网络有多条“距离相等”的路由时，可以进行等价负载均衡，即将通信量均衡地分布到多条等价的路由上。
e、RIP包含以下三个要点:
    (1)和谁交换信息：仅和相邻路由器交换信息。
    (2)交换什么信息：自己的路由表。
    (3)何时交换信息：周期性交换(例如每30秒)。
</code></pre>
<h4 id="1、基本工作过程："><a href="#1、基本工作过程：" class="headerlink" title="1、基本工作过程："></a>1、基本工作过程：</h4><pre><code>a、路由器刚开始工作时，只知道自己到直连网络的距离为1。
b、每个路由器仅和相邻路由器周期性地交换并更新路由信息。
c、若干次交换和更新后，每个路由器都知道到达本AS内各网络的最短距离和下一跳地址，称为收敛。
</code></pre>
<h4 id="2、路由条目更新规则-条目内容为：目的网络-距离-下一跳-："><a href="#2、路由条目更新规则-条目内容为：目的网络-距离-下一跳-：" class="headerlink" title="2、路由条目更新规则(条目内容为：目的网络-距离-下一跳)："></a>2、路由条目更新规则(条目内容为：目的网络-距离-下一跳)：</h4><pre><code>a、路由器收到相邻路由器封装有路由信息的RIP更新报文，其内容包含相邻路由器的路由条目：目的网络及距离。接收报文的路由器无需关心该路由条目的下一跳，仅将每个条目的距离加1，并将下一跳设为相邻路由器，便可和自身路由条目对比更新，因其自身到达相邻路由器中目的网络的距离为相邻路由器条目中的距离加1。
b、若发现新的网络，添加；
c、若目的网络和下一跳相同，最新消息，更新距离；
d、若目的网络相同，下一跳不同，新路由距离小，更新距离和下一跳为新路由；
e、若目的网络相同，下一跳不同，距离相同，添加，进行等价负载均衡；
f、若目的网络相同，下一跳不同，新路由距离大于旧路由，不更新。
</code></pre>
<h4 id="3、RIP“坏消息传得慢”问题："><a href="#3、RIP“坏消息传得慢”问题：" class="headerlink" title="3、RIP“坏消息传得慢”问题："></a>3、RIP“坏消息传得慢”问题：</h4><pre><code>a、某路由器直连网络故障，路由器在更改条目为不可达之后，还未来得及向相邻路由器发送RIP更新报文，期间收到更新报文，因更新报文中到达故障网络的距离小于自身修改的不可达，听信“谣言”，以为故障网络可达，并修改自身条目距离为报文距离加1。后该错误条目随RIP更新报文发往相邻路由器，相邻路由器收到后修改自身条目距离加1，以此循环直至距离增加到16即不可达。
b、“坏消息传播得慢”又称为路由环路或距离无穷计数问题，这是距离向量算法的一个固有问题。
c、可以采取多种措施减少出现该问题的概率或减小该问题带来的危害：
    (1)限制最大路径距离为15(16表示不可达);
    (2)当路由表发生变化时就立即发送更新报文(即“触发更新”)，而不仅是周期性发送;
    (3)让路由器记录收到某特定路由信息的接口，而不让同一路由信息再通过此接口向反方向传送(即“水平分割”)。
</code></pre>
<h2 id="开放最短路径优先协议-OSPF"><a href="#开放最短路径优先协议-OSPF" class="headerlink" title="开放最短路径优先协议 OSPF"></a>开放最短路径优先协议 OSPF</h2><pre><code>a、开放最短路径优先OSPF(0pen ShorestPath First)，是为克服RIP的缺点在1989年开发出来的。“开放”表明OSPF协议不是受某一家厂商控制，而是公开发表的。“最短路径优先”是因为使用了Dijkstra提出的最短路径算法SPF。
b、OSPF是基于链路状态的，而不像RIP那样是基于距离向量的。
c、OSPF采用SPF算法计算路由，从算法上保证了不会产生路由环路。
d、OSPF不限制网络规模，更新效率高，收敛速度快。
e、链路状态是指本路由器都和哪些路由器相邻，以及相应链路的“代价”(cost)。“代价”用来表示费用、距离、时延、带宽，等等。这些都由网络管理人员来决定。这些代价被SPF算法用于计算最短路径。
</code></pre>
<h4 id="1、工作原理："><a href="#1、工作原理：" class="headerlink" title="1、工作原理："></a>1、工作原理：</h4><pre><code>a、OSPF相邻路由器之间通过交互问候(Hello)分组，建立和维护邻居关系：
    (1)Hello分组封装在IP数据报中，发往组播地址224.0.0.5
    (2)IP数据报格式：
</code></pre>
<table>
<thead>
<tr>
<th align="center">源 IP</th>
<th align="center">目的 IP</th>
<th align="center">协议号</th>
<th>OSPF 首部</th>
<th>OSPF 载荷分组</th>
</tr>
</thead>
<tbody><tr>
<td align="center">路由器接口 IP</td>
<td align="center">224.0.0.5</td>
<td align="center">89</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<pre><code>    (协议号89表明IP数据报的数据载荷为OSPF分组)
    (3)发送周期为10秒;40秒未收到来自邻居路由器的Hello分组，则认为该邻居路由器不可达。
b、使用OSPF的每个路由器都会产生链路状态通告LSA(Link State Adverisement)。LSA中包含以下内容:
    (1)直连网络的链路状态信息。
    (2)邻居路由器的链路状态信息。
c、LSA被封装在链路状态更新分组LSU中，采用洪泛法发送。
d、使用OSPF的每个路由器都有一个链路状态数据库LSDB，用于存储LSA。通过各路由器洪泛发送封装有自己LSA的LSU分组，各路由器的LSDB最终将达到一致。
e、使用OSPF的各路由器基于LSDB进行最短路径优先SPF计算，构建出各自到达其他各路由器的最短路径，即构建各自的路由表。
</code></pre>
<h4 id="2、OSPF-的分组类型："><a href="#2、OSPF-的分组类型：" class="headerlink" title="2、OSPF 的分组类型："></a>2、OSPF 的分组类型：</h4><pre><code>a、类型1，问候(Hello)分组：用来发现和维护邻居路由器的可达性。
b、类型2，数据库描述(Database Description)分组：向邻居路由器给出自己的链路状态数据库中的所有链路状态项目的摘要信息。
c、类型3，链路状态请求(Link State Request)分组：向邻居路由器请求发送某些链路状态项目的详细信息。
d、类型4，链路状态更新(Link State Update)分组：路由器使用这种分组将其链路状态进行洪泛发送，即用洪泛法对全网更新链路状态。
e、类型5，链路状态确认(Link State Acknowledgment)分组：这是对链路状态更新分组的确认分组。
</code></pre>
<h4 id="3、基本工作过程："><a href="#3、基本工作过程：" class="headerlink" title="3、基本工作过程："></a>3、基本工作过程：</h4><pre><code>a、建立和维护邻居关系：相邻路由器之间周期性发送问候分组。
b、链路状态数据库同步：建立邻居关系后，各路由向相邻路由发送自身的数据库描述分组；各路由器接收后，对比自身数据库发现缺少的某些链路状态项目；向相邻路由器发送链路状态请求分组；相邻路由器收到请求分组后，将缺少的链路状态项目的详细信息封装在链路状态更新分组中，发送给发送请求的路由器；路由器收到更新分组后，将所缺少的链路状态项目的详细信息添加到自己的链路状态数据库中，并向相邻路由器发送链路状态确认分组；最终，各路由器的链路状态数据库达到一致。
c、新情况下链路状态数据库同步：每30分钟或链路状态发生变化时，路由器都会发送链路状态更新分组，收到该分组的其他路由器都会洪泛转发该分组，并给该路由器发送链路状态确认分组。
</code></pre>
<p><img src="/images/QQ20250215-221019.png" alt="基本工作过程"></p>
<h4 id="4、OSPF-在多点接入网络中路由器邻居关系的建立："><a href="#4、OSPF-在多点接入网络中路由器邻居关系的建立：" class="headerlink" title="4、OSPF 在多点接入网络中路由器邻居关系的建立："></a>4、OSPF 在多点接入网络中路由器邻居关系的建立：</h4><pre><code>a、多点接入网络中的路由器两两相邻，若不采取其他机制，将会产生大量的多播分组。
b、解决：选举指定路由器DR(designated router)和备用的指定路由器BDR(backup designated router)。所有的非DR/BDR只与DR/BDR建立邻居关系；非DR/BDR之间通过DR/BDR交换信息。
</code></pre>
<h4 id="5、为了使-OSPF-能够用于规模很大的网络，OSPF-把一个自治系统再划分为若干个更小的范围叫做区域-Area"><a href="#5、为了使-OSPF-能够用于规模很大的网络，OSPF-把一个自治系统再划分为若干个更小的范围叫做区域-Area" class="headerlink" title="5、为了使 OSPF 能够用于规模很大的网络，OSPF 把一个自治系统再划分为若干个更小的范围叫做区域(Area)"></a>5、为了使 OSPF 能够用于规模很大的网络，OSPF 把一个自治系统再划分为若干个更小的范围叫做区域(Area)</h4><p><img src="/images/QQ20250215-221221.png" alt="区域划分"></p>
<pre><code>a、每个区域都有一个32比特的区域标识符，可用点分十进制表示。主干区域的标识符必须为0。
b、主干区域用于连通其他区域，其他区域的标识符各不相同且不能为0。每个区域的规模不应超过200个路由器。
c、划分区域将利用洪泛法交换链路状态信息的范围局限到每个区域而不是整个自治系统，这样减少了整个网络上的通信量。
d、区域内路由器：路由器的所有接口都在一个区域内。
e、区域边界路由器：一个接口用于连接本区域，另一个接口用于连接主干区域。分别向主干区域发送自身区域的链路状态通告和向自身区域发送其他区域的链路状态通告。
f、主干路由器：主干区域内的路由器，也可将区域边界路由器看作主干路由器。
g、自治系统边界路由器：主干区域内的专门用于和本自治系统外的其他自治系统交换路由信息的路由器。
</code></pre>
<h2 id="边界网关协议-BGP"><a href="#边界网关协议-BGP" class="headerlink" title="边界网关协议 BGP"></a>边界网关协议 BGP</h2><pre><code>a、在不同自治系统内，度量路由的“代价”(距离，带宽，费用等)可能不同。因此，对于自治系统之间的路由选择，使用“代价”作为度量来寻找最佳路由是不行的。
b、自治系统之间的路由选择必须考虑相关策略(政治，经济，安全等)。
c、BGP只能是力求寻找一条能够到达目的网络且比较好的路由(不能兜圈子)而并非要寻找一条最佳路由。
d、适用多级结构的以太网。
</code></pre>
<h4 id="1、基本工作原理："><a href="#1、基本工作原理：" class="headerlink" title="1、基本工作原理："></a>1、基本工作原理：</h4><pre><code>a、在配置BGP时，每个自治系统的管理员要选择至少一个路由器作为该自治系统的“BGP发言人”，一般两个BGP发言人通过一个共享网络连接在一起，往往为BGP边界路由器。
b、不同自治系统的BGP发言人要交换路由信息，首先必须建立TCP连接，端口号为179：
    (1)在此TCP连接上交换BGP报文以建立BGP会话；
    (2)利用BGP会话交换路由信息(例如，增加新的路由，或撤销过时的路由，以及报告出错的情况等)；
    (3)使用TCP连接交换路由信息的两个BGP发言人，彼此称为对方的邻站(neighbor)或对等站(peer)。
c、BGP 发言人除了运行 BGP 外，还必须运行自己所在自治系统所使用的内部网关协议 IGP，例如OSPF或RIP。
d、BGP发言人交换网络可达性的信息(要到达某个网络所要经过的一系列自治系统)。
e、当BGP发言人互相交换了网络可达性的信息后，各BGP发言人就根据所采用的策略从收到的路由信息中找出到达各自治系统的较好的路由。也就是构造出树形结构、不存在回路的自治系统连通图。
</code></pre>
<h4 id="2、BGP-4-的四种报文："><a href="#2、BGP-4-的四种报文：" class="headerlink" title="2、BGP-4 的四种报文："></a>2、BGP-4 的四种报文：</h4><pre><code>a、OPEN(打开)报文:用来与相邻的另一个BGP发言人建立关系，使通信初始化。
b、UPDATE(更新)报文:用来通告某一路由的信息，以及列出要撤销的多条路由
c、KEEPALIVE(保活)报文:用来周期性地证实邻站的连通性。
d、NOTIFICATION(通知)报文:用来发送检测到的差错。
</code></pre>
<h2 id="IPv4-数据报的首部格式"><a href="#IPv4-数据报的首部格式" class="headerlink" title="IPv4 数据报的首部格式"></a>IPv4 数据报的首部格式</h2><p><img src="/images/QQ20250216-143930.png" alt="IP数据报首部格式"></p>
<pre><code>a、IP数据报首部以32个bit即4字节为单位描述。前20字节为固定部分，其为每个IP数据报首部必须包含的部分；最长可有40字节的可变部分，来增加IP数据报的功能。
b、版本字段：占4比特，表示IP协议的版本。通信双方使用的IP协议的版本必须一致。目前广泛使用的IP协议版本号为4(即IPv4)。
c、首部长度字段：占4比特，表示IP数据报首部的长度。该字段的取值以4字节为单位。最小十进制取值为5，表示IP数据报首部只有20字节固定部分;最大十进制取值为15，表示IP数据报首部包含20字节固定部分和最大40字节可变部分。
d、可选字段：长度从1个字节到40个字节不等。用来支持排错、测量及安全等措施。可选字段增加了IP数据报的功能，但这同时也使得IP数据报的首部长度成为可变的。这就增加了每一个路由器处理IP数据报的开销。实际上可选字段很少被使用。
e、填充字段：确保首部长度为4字节的整数倍(首部长度字段以4字节为单位，因此需要保证首部长度为4的整数倍)。使用全0进行填充。
f、区分服务字段：占8比特，用来获得更好的服务。该字段在旧标准中叫作服务类型，但实际上一直没有被使用过。1998年，因特网工程任务组IETF把这个字段改名为区分服务。利用该字段的不同数值可提供不同等级的服务质量。只有在使用区分服务时，该字段才起作用。一般情况下都不使用该字段。
g、总长度字段：占16比特，表示IP数据报的总长度(首部+数据载荷)。最大取值为十进制的65535，以字节为单位。
h、标识字段、标志字段、片偏移字段共同用于IP数据报分片，由于IP数据报的长度受限于数据链路层帧的数据载荷即最大传输单元MTU，当IP数据报的长度大于其时需对IP数据报的数据载荷进行分片使其变为更小的IP数据报，每个分片的IP数据报都要有首部：
    (1)标识字段：占16比特，属于同一个数据报的各分片数据报应该具有相同的标识。IP软件维持一个计数器，每产生一个数据报，计数器值加1，并将此值赋给标识字段。
    (2)标志字段：占3比特，各比特含义如下:
        DF位:1表示不允许分片;0表示允许分片。
        MF位:1表示“后面还有分片”;0表示“这是最后一个分片”。
        保留位: 必须为0。
    (3)片偏移字段；占13比特，指出分片数据报的数据载荷部分偏移其在原数据报的位置有多少个单位。片偏移以8个字节为单位。
i、生存时间TTL字段：占8比特，最初以秒为单位，最大生存周期为255秒;路由器转发IP数据报时，将IP数据报首部中的该字段的值减去IP数据报在本路由器上所耗费的时间，若不为0就转发，否则就丢弃。现在以“跳数”为单位，路由器转发IP数据报时，将IP数据报首部中的该字段的值减1，若不为0就转发，否则就丢弃。其作用为防止IP数据报在网络中永久兜圈。
j、协议字段：占8比特，指明IPv4数据报的数据部分是何种协议数据单元。常用的一些协议和相应的协议字段值如下：
</code></pre>
<table>
<thead>
<tr>
<th align="center">协议名称</th>
<th align="center">ICMP</th>
<th align="center">IGMP</th>
<th align="center">TCP</th>
<th align="center">UDP</th>
<th align="center">IPv6</th>
<th align="center">OSPF</th>
</tr>
</thead>
<tbody><tr>
<td align="center">协议字段值</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">6</td>
<td align="center">17</td>
<td align="center">41</td>
<td align="center">89</td>
</tr>
</tbody></table>
<pre><code>k、首部检验和字段：占16比特，用来检测首部在传输过程中是否出现差错。比CRC检验码简单，称为因特网检验和。IP数据报每经过一个路由器，路由器都要重新计算首部检验和，因为某些字段(生存时间、标志片偏移等)的取值可能发生变化。由于IP层本身并不提供可靠传输的服务，并且计算首部校验和是一项耗时的操作，因此在IPv6中路由器不再计算首部校验和，从而更快转发IP数据报。
l、源IP地址和目的IP地址字段：各占32比特，用来填写发送该IP数据报的源主机的IP地址和接收该IP数据报的目的主机的IP地址。
</code></pre>
<h2 id="网际控制报文协议-ICMP"><a href="#网际控制报文协议-ICMP" class="headerlink" title="网际控制报文协议 ICMP"></a>网际控制报文协议 ICMP</h2><pre><code>a、为了更有效地转发IP数据报和提高交付成功的机会，在网际层使用了网际控制报文协议ICMP(Internet Control Message Protocol)。
b、主机或路由器使用ICMP来发送差错报告报文和询问报文。
c、ICMP报文被封装在IP数据报中发送。
</code></pre>
<h4 id="1、ICMP-差错报文类型："><a href="#1、ICMP-差错报文类型：" class="headerlink" title="1、ICMP 差错报文类型："></a>1、ICMP 差错报文类型：</h4><pre><code>a、终点不可达：当路由器或主机不能交付数据报时，就向源点发送终点不可达报文。具体可再根据ICMP的代码字段细分为目的网络不可达目的主机不可达、目的协议不可达、目的端口不可达、目的网络未知、目的主机未知等13种错误。
b、源点抑制：当路由器或主机由于拥塞而丢弃数据报时，就向源点发送源点抑制报文，使源点知道应当把数据报的发送速率放慢。
c、时间超过：
    (1)当路由器收到一个目的IP地址不是自己的IP数据报，会将其生存时间TTL字段的值减1。若结果不为0，则将该IP数据报转发出去;若结果为0，除丢奔该IP数据报外，还要向源点发送时间超过报文。
    (2)另外，当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，也会向源点发送时间超过报文。
d、参数问题：当路由器或目的主机收到IP数据报后，根据其首部中的检验和字段发现首部在传输过程中出现了误码，就丢弃该数据报，并向源点发送参数问题报文。
e、改变路由(重定向)：路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器(可通过更好的路由)。
</code></pre>
<h4 id="2、不应发送-ICMP-差错报告报文的情况："><a href="#2、不应发送-ICMP-差错报告报文的情况：" class="headerlink" title="2、不应发送 ICMP 差错报告报文的情况："></a>2、不应发送 ICMP 差错报告报文的情况：</h4><pre><code>a、对ICMP差错报告报文不再发送ICMP差错报告报文；
b、对第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报告报文；
c、对具有多播地址的数据报都不发送ICMP差错报告报文；
d、对具有特殊地址(如127.0.0.0或0.0.0.0)的数据报不发送ICMP差错报告报文。
</code></pre>
<h4 id="3、常见的-ICMP-询问报文："><a href="#3、常见的-ICMP-询问报文：" class="headerlink" title="3、常见的 ICMP 询问报文："></a>3、常见的 ICMP 询问报文：</h4><pre><code>a、回送请求报文和回答报文：
    (1)ICMP回送请求报文是由主机或路由器向一个特定的目的主机发出的询问。
    (2)收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文。
    (3)这种询问报文用来测试目的站是否可达及了解其有关状态。
b、时间戳请求报文和回答报文：
    (1)ICMP时间戳请求报文是请某个主机或路由器回答当前的日期和时间。
    (2)在ICMP时间戳回答报文中有一个32位的字段，其中写入的整数代表从1900年1月1日起到当前时刻一共有多少秒。
    (3)这种询问报文用来进行时钟同步和测量时间。
</code></pre>
<h4 id="ICMP-应用："><a href="#ICMP-应用：" class="headerlink" title="ICMP 应用："></a>ICMP 应用：</h4><pre><code>a、分组网间探测PING(Packet InterNet Groper)：
    (1)用来测试主机或路由器间的连通性;
    (2)应用层直接使用网际层的ICMP(没有通过运输层的TCP或UDP)；
    (3)使用ICMP回送请求和回答报文。
b、跟踪路由traceroute：
    (1)用来测试IP数据报从源主机到达目的主机要经过哪些路由器。
    (2)Windows版本:
        tracert命令
        应用层直接使用网际层ICMP
        使用了ICMP回送请求和回答报文以及差错报告报文
    (3)Unix版本:
        traceroute命令
        在运输层使用UDP协议
        仅使用ICMP差错报告报文
    (4)通过不断发送TTL从1逐渐递增的ICMP回送请求直至到达目的主机实现。
</code></pre>
<h2 id="虚拟专用网-VPN-和网络地址转换-NAT"><a href="#虚拟专用网-VPN-和网络地址转换-NAT" class="headerlink" title="虚拟专用网 VPN 和网络地址转换 NAT"></a>虚拟专用网 VPN 和网络地址转换 NAT</h2><h4 id="1、虚拟专用网-VPN-Virtual-Private-Network-："><a href="#1、虚拟专用网-VPN-Virtual-Private-Network-：" class="headerlink" title="1、虚拟专用网 VPN(Virtual Private Network)："></a>1、虚拟专用网 VPN(Virtual Private Network)：</h4><pre><code>a、利用公用的因特网作为本机构各专用网之间的通信载体，这样的专用网又称为虚拟专用网。由于IPv4地址的紧缺，一个机构能够申请到的IPv4地址数量往往远小于本机构所拥有的主机数量。因此，虚拟专用网中的各主机所分配的地址应该是本机构可自由分配的专用地址而不是需要申请的、在因特网上使用的公有地址。
b、无需申请的IPv4私有(专用)地址：
    10.0.0.0~10.255.255.255(10/8地址块)
    172.16.0.0~172.31.255.255(172.16/12地址块)
    192.168.0.0~192.168.255.255(192.168/16地址块)
c、私有地址只能用于一个机构内部主机之间的通信，而不能用于和以太网上的主机通信。即私有地址只能用于本地地址而不能用于全球地址。以太网中的所有路由器对目的地址是私有地址的IP数据报一律不进行转发。
d、一个机构的内部网络不同地域之间的主机通信：
    (1)不同地域的部门至少需要一个拥有合法全球IP地址的路由器，使其各自的专用网能通过公用的以太网通信。
    (2)当一个部门的内部主机向另一个部门的内部主机发起通信时，其将待发送的数据封装为内部IP数据报，该数据报首部的源IP地址为发送主机的内部IP，目的地址为通信主机的内部IP，内部IP数据报被发往网关(连接公网的路由器)。
    (3)网关收到数据报后，发现其到达目的主机需要通过公网。便将该IP数据报进行加密，确保了内部IP数据报的安全，重新添加数据报的首部，封装为在以太网上发送的外部数据报，其首部的源地址为路由器的全球地址，目的地址为目的主机所在网络网关的全球地址。
    (4)目的网关收到该外部数据报后，去掉首部，进行解密，恢复为内部数据报。根据数据报中的目的地址发往相应的主机。
e、虚拟专用网也被称为IP隧道技术。
</code></pre>
<h4 id="2、VPN-的类型："><a href="#2、VPN-的类型：" class="headerlink" title="2、VPN 的类型："></a>2、VPN 的类型：</h4><pre><code>a、内联网VPN：同一机构内不同部门的内部网络所构成的虚拟专用网VPN。
b、外联网VPN：有时一个机构的VPN需要有某些外部机构(通常就是合作伙伴)参加进来。
c、远程接入VPN：在外地工作的员工需要访问公司内部的专用网络时，只要在任何地点接入到因特网，运行驻留在员工PC中的VPN软件，在员工的PC和公司的主机之间建立VPN隧道，即可访问专用网络中的资源。
</code></pre>
<h4 id="3、网络地址转换-NAT-Network-Address-Translation-："><a href="#3、网络地址转换-NAT-Network-Address-Translation-：" class="headerlink" title="3、网络地址转换 NAT(Network Address Translation)："></a>3、网络地址转换 NAT(Network Address Translation)：</h4><pre><code>a、1994年提出了一种网络地址转换NAT的方法再次缓解了IPv4地址空间即将耗尽的问题。NAT能使大量使用内部专用地址的专用网络用户共享少量外部全球地址来访问因特网上的主机和资源。
b、装有NAT软件的路由器称为NAT路由器，其至少有一个有效的全球IP地址。
c、所有使用私有地址的主机和外界通信时，NAT路由器会将数据报中源地址由原来的私有地址改变为路由器全球IP地址池中的某个全球IP地址；然后将私有地址和全球地址的对应关系记录在NAT转换表中；然后进行转发，此时数据报首部的源地址和目的地址均为全球IP地址；路由器收到外部主机发回的数据报后，在NAT转换表中查找与数据报目的地址对应的私有地址，将数据报目的地址改为对应的私有地址，再进行转发。
d、该转换方法存在一个问题:如果NAT路由器具有N个全球IP地址，那么至多只能有N个内网主机能够同时和因特网上的主机通信。
e、外网主机不能主动发起对内网主机的通信，因此内网主机不能直接充当服务器，需要网络应用自己使用一些特殊的NAT穿越技术来解决问题。
f、由于NAT对外网屏蔽了内网主机的网络地址，能为肉网的主机提供一定的安全保护。
</code></pre>
<h4 id="4、网络地址与端口号转换-NAPT-Network-Address-and-Port-Translation-："><a href="#4、网络地址与端口号转换-NAPT-Network-Address-and-Port-Translation-：" class="headerlink" title="4、网络地址与端口号转换 NAPT(Network Address and Port Translation)："></a>4、网络地址与端口号转换 NAPT(Network Address and Port Translation)：</h4><pre><code>由于绝大多数的网络应用都是使用运输层协议TCP或UDP来传送数据，因此可以利用运输层的端口号和IP地址一起进行转换。这样，用一个全球IP地址就可以使多个拥有本地地址的主机同时和因特网上的主机进行通信。
</code></pre>

    </div>

    
    
    

 
   <div>
     <div>
    
        <div style="text-align:center;color: #ccc;font-size:24px;">-------------本文结束<i class="far fa-power-off"></i>感谢您的阅读-------------</div>
    
</div>
   </div>
 
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>hakusuri
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://example.com/2025/02/22/%E7%BD%91%E7%BB%9C%E5%B1%82/" title="网络层">http://example.com/2025/02/22/网络层/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag"># 计算机网络</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/02/22/%E8%BF%90%E8%BE%93%E5%B1%82/" rel="prev" title="运输层">
      <i class="fa fa-chevron-left"></i> 运输层
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/02/22/%E5%BA%94%E7%94%A8%E5%B1%82/" rel="next" title="应用层">
      应用层 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="nav-number">1.</span> <span class="nav-text">网络层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%B1%BB%E5%9E%8B%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.2.</span> <span class="nav-text">网络层提供的两种类型服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E9%9D%A2%E5%90%91%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%99%9A%E7%94%B5%E8%B7%AF%E6%9C%8D%E5%8A%A1%EF%BC%9A"><span class="nav-number">1.2.0.1.</span> <span class="nav-text">1、面向连接的虚电路服务：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E6%97%A0%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%9C%8D%E5%8A%A1%EF%BC%9A"><span class="nav-number">1.2.0.2.</span> <span class="nav-text">2、无连接的数据报服务：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%AF%94%E8%BE%83"><span class="nav-number">1.2.0.3.</span> <span class="nav-text">3、两种服务的比较</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPv4-%E5%9C%B0%E5%9D%80"><span class="nav-number">1.3.</span> <span class="nav-text">IPv4 地址</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E6%A6%82%E8%BF%B0%EF%BC%9A"><span class="nav-number">1.3.0.1.</span> <span class="nav-text">1、概述：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80%E7%9A%84-IPv4-%E5%9C%B0%E5%9D%80"><span class="nav-number">1.3.0.2.</span> <span class="nav-text">2、分类编址的 IPv4 地址</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-A-%E7%B1%BB%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="nav-number">1.3.0.2.1.</span> <span class="nav-text">(1)A 类地址：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-B-%E7%B1%BB%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="nav-number">1.3.0.2.2.</span> <span class="nav-text">(2)B 类地址：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-C-%E7%B1%BB%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="nav-number">1.3.0.2.3.</span> <span class="nav-text">(3)C 类地址：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E7%89%B9%E6%AE%8A-IP-%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="nav-number">1.3.0.2.4.</span> <span class="nav-text">(4)特殊 IP 地址：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E7%9A%84-Ipv4-%E5%9C%B0%E5%9D%80%EF%BC%9A%E9%80%9A%E8%BF%87%E5%80%9F%E7%94%A8%E5%88%86%E7%B1%BB-IP-%E5%9C%B0%E5%9D%80%E7%9A%84%E4%B8%80%E4%BA%9B%E4%B8%BB%E6%9C%BA%E4%BD%8D%E6%9D%A5%E4%BD%9C%E4%B8%BA%E5%AD%90%E7%BD%91%E4%BD%8D%EF%BC%8C%E5%B0%86%E4%B8%80%E4%B8%AA%E5%A4%A7%E7%9A%84%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E5%88%92%E5%88%86%E4%B8%BA%E5%A4%9A%E4%B8%AA%E5%AD%90%E7%BD%91%EF%BC%8C%E4%BA%8C%E7%BA%A7%E7%BB%93%E6%9E%84%E7%9A%84%E5%88%86%E7%B1%BB-IP-%E5%9C%B0%E5%9D%80-%E7%BD%91%E7%BB%9C%E5%8F%B7-%E4%B8%BB%E6%9C%BA%E5%8F%B7-%E5%8F%98%E4%B8%BA%E4%B8%89%E7%BA%A7%E7%BB%93%E6%9E%84%E7%9A%84%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91-IP-%E5%9C%B0%E5%9D%80-%E7%BD%91%E7%BB%9C%E5%8F%B7-%E5%AD%90%E7%BD%91%E5%8F%B7-%E4%B8%BB%E6%9C%BA%E5%8F%B7-%E3%80%82"><span class="nav-number">1.3.0.3.</span> <span class="nav-text">3、划分子网的 Ipv4 地址：通过借用分类 IP 地址的一些主机位来作为子网位，将一个大的网络地址划分为多个子网，二级结构的分类 IP 地址(网络号-主机号)变为三级结构的划分子网 IP 地址(网络号-子网号-主机号)。</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#a%E3%80%81%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%EF%BC%9A32bit-%E7%9A%84%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E5%8F%AF%E7%94%A8%E8%A1%A8%E6%98%8E%E5%88%86%E7%B1%BB-IP-%E5%9C%B0%E5%9D%80%E7%9A%84%E4%B8%BB%E6%9C%BA%E5%8F%B7%E9%83%A8%E5%88%86%E8%A2%AB%E5%80%9F%E7%94%A8%E4%BA%86%E5%87%A0%E4%B8%AA%E6%AF%94%E7%89%B9%E4%BD%9C%E4%B8%BA%E5%AD%90%E7%BD%91%E5%8F%B7%E3%80%82"><span class="nav-number">1.3.0.3.1.</span> <span class="nav-text">a、子网掩码：32bit 的子网掩码可用表明分类 IP 地址的主机号部分被借用了几个比特作为子网号。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#b%E3%80%81%E9%BB%98%E8%AE%A4%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%EF%BC%9A%E6%8C%87%E5%9C%A8%E6%9C%AA%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E4%BD%BF%E7%94%A8%E7%9A%84%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E3%80%82"><span class="nav-number">1.3.0.3.2.</span> <span class="nav-text">b、默认子网掩码：指在未划分子网的情况下使用的子网掩码。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80%E7%9A%84-IPv4-%E5%9C%B0%E5%9D%80%EF%BC%9A%E5%B0%86-32bit-%E5%88%86%E4%B8%BA%E7%BD%91%E7%BB%9C%E5%89%8D%E7%BC%80%E5%92%8C%E4%B8%BB%E6%9C%BA%E7%BC%96%E5%8F%B7%EF%BC%8C%E7%BD%91%E7%BB%9C%E5%89%8D%E7%BC%80%E7%9A%84-bit-%E6%95%B0%E5%86%99%E5%9C%A8%E2%80%9C-%E2%80%9D%E5%90%8E%E9%9D%A2%E3%80%82"><span class="nav-number">1.3.0.4.</span> <span class="nav-text">4、无分类编址的 IPv4 地址：将 32bit 分为网络前缀和主机编号，网络前缀的 bit 数写在“&#x2F;”后面。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81IPv4-%E5%9C%B0%E5%9D%80%E7%9A%84%E5%BA%94%E7%94%A8%E8%A7%84%E5%88%92%EF%BC%9A"><span class="nav-number">1.3.0.5.</span> <span class="nav-text">5、IPv4 地址的应用规划：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IP-%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E5%8F%91%E9%80%81%E5%92%8C%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="nav-number">1.4.</span> <span class="nav-text">IP 数据报的发送和转发过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81IP-%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E5%8F%91%E9%80%81%E5%92%8C%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B%E5%8C%85%E5%90%AB%E4%BB%A5%E4%B8%8B%E4%B8%A4%E9%83%A8%E5%88%86"><span class="nav-number">1.4.0.1.</span> <span class="nav-text">1、IP 数据报的发送和转发过程包含以下两部分:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E6%95%B0%E6%8D%AE%E6%8A%A5%E4%BA%A4%E4%BB%98%E7%9A%84%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="nav-number">1.4.0.2.</span> <span class="nav-text">2、数据报交付的分类：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E6%BA%90%E4%B8%BB%E6%9C%BA%E5%88%A4%E6%96%AD%E7%9B%AE%E7%9A%84%E4%B8%BB%E6%9C%BA%E6%98%AF%E5%90%A6%E5%92%8C%E8%87%AA%E8%BA%AB%E5%9C%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%EF%BC%9A"><span class="nav-number">1.4.0.3.</span> <span class="nav-text">3、源主机判断目的主机是否和自身在同一个网络：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E9%BB%98%E8%AE%A4%E7%BD%91%E5%85%B3%EF%BC%9A%E4%B8%8E%E6%9F%90%E5%B1%80%E5%9F%9F%E7%BD%91%E7%9B%B4%E6%8E%A5%E7%9B%B8%E8%BF%9E%E7%9A%84%E8%B7%AF%E7%94%B1%E5%99%A8%E6%8E%A5%E5%8F%A3-IP-%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%AF%A5%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E7%9A%84%E4%B8%BB%E6%9C%BA%E5%B0%86%E8%AF%A5%E6%8E%A5%E5%8F%A3%E7%9A%84-IP-%E5%9C%B0%E5%9D%80%E4%BD%9C%E4%B8%BA%E9%BB%98%E8%AE%A4%E7%BD%91%E5%85%B3%E3%80%82"><span class="nav-number">1.4.0.4.</span> <span class="nav-text">4、默认网关：与某局域网直接相连的路由器接口 IP 地址，该局域网内的主机将该接口的 IP 地址作为默认网关。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81%E8%B7%AF%E7%94%B1%E5%99%A8%E8%BD%AC%E5%8F%91%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="nav-number">1.4.0.5.</span> <span class="nav-text">5、路由器转发数据报过程：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%E3%80%81"><span class="nav-number">1.4.0.6.</span> <span class="nav-text">6、</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.</span> <span class="nav-text">静态路由配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%EF%BC%9A%E6%98%AF%E4%B8%80%E7%A7%8D%E7%89%B9%E6%AE%8A%E7%9A%84%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%EF%BC%8C%E5%BD%93%E8%B7%AF%E7%94%B1%E8%A1%A8%E4%B8%AD%E7%9A%84%E6%9D%A1%E7%9B%AE%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9B%AE%E7%9A%84%E5%9C%B0%E5%9D%80%E6%B2%A1%E6%9C%89%E5%8C%B9%E9%85%8D%E7%9A%84%E8%A1%A8%E9%A1%B9%E6%97%B6%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%8C%85%E5%B0%86%E6%A0%B9%E6%8D%AE%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%E6%9D%A1%E7%9B%AE%E8%BF%9B%E8%A1%8C%E8%BD%AC%E5%8F%91%E3%80%82"><span class="nav-number">1.5.0.1.</span> <span class="nav-text">1、默认路由：是一种特殊的静态路由，当路由表中的条目与数据包目的地址没有匹配的表项时，数据包将根据默认路由条目进行转发。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E7%89%B9%E5%AE%9A%E4%B8%BB%E6%9C%BA%E8%B7%AF%E7%94%B1%EF%BC%9A%E5%AF%B9%E7%89%B9%E5%AE%9A%E7%9A%84%E7%9B%AE%E7%9A%84%E4%B8%BB%E6%9C%BA%E6%8C%87%E6%98%8E%E4%B8%80%E4%B8%AA%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E6%9D%A1%E7%9B%AE%E3%80%82"><span class="nav-number">1.5.0.2.</span> <span class="nav-text">2、特定主机路由：对特定的目的主机指明一个静态路由条目。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E6%9C%80%E9%95%BF%E5%89%8D%E7%BC%80%E5%8C%B9%E9%85%8D%EF%BC%9A%E5%BD%93%E8%B7%AF%E7%94%B1%E5%99%A8%E6%94%B6%E5%88%B0%E4%B8%80%E4%B8%AA-IP-%E6%95%B0%E6%8D%AE%E5%8C%85%E6%97%B6%EF%BC%8C%E5%AE%83%E4%BC%9A%E5%B0%86%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E7%9B%AE%E7%9A%84-IP-%E5%9C%B0%E5%9D%80%E4%B8%8E%E8%87%AA%E5%B7%B1%E6%9C%AC%E5%9C%B0%E8%B7%AF%E7%94%B1%E8%A1%A8%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E8%B7%AF%E7%94%B1%E8%A1%A8%E8%BF%9B%E8%A1%8C%E9%80%90%E4%BD%8D%EF%BC%88Bit-By-Bit%EF%BC%89%E5%AF%B9%E6%AF%94%EF%BC%8C%E7%9B%B4%E5%88%B0%E6%89%BE%E5%88%B0%E5%8C%B9%E9%85%8D%E5%BA%A6%E6%9C%80%E9%95%BF%E7%9A%84%E6%9D%A1%E7%9B%AE%E8%BF%9B%E8%A1%8C%E8%BD%AC%E5%8F%91%E3%80%82"><span class="nav-number">1.5.0.3.</span> <span class="nav-text">3、最长前缀匹配：当路由器收到一个 IP 数据包时，它会将数据包的目的 IP 地址与自己本地路由表中的所有路由表进行逐位（Bit-By-Bit）对比，直到找到匹配度最长的条目进行转发。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E8%B7%AF%E7%94%B1%E7%8E%AF%E8%B7%AF%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="nav-number">1.5.0.4.</span> <span class="nav-text">4、路由环路问题：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.6.</span> <span class="nav-text">路由选择协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="nav-number">1.6.0.1.</span> <span class="nav-text">1、路由选择分类：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E5%9B%A0%E7%89%B9%E7%BD%91%E9%87%87%E7%94%A8%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE%E7%89%B9%E7%82%B9%EF%BC%9A"><span class="nav-number">1.6.0.2.</span> <span class="nav-text">2、因特网采用的路由选择协议特点：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE%EF%BC%9A"><span class="nav-number">1.6.0.3.</span> <span class="nav-text">3、常见的路由选择协议：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E8%B7%AF%E7%94%B1%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%EF%BC%9A%E5%85%B7%E6%9C%89%E5%A4%9A%E4%B8%AA%E8%BE%93%E5%85%A5%E7%AB%AF%E5%8F%A3%E5%92%8C%E8%BE%93%E5%87%BA%E7%AB%AF%E5%8F%A3%E7%9A%84%E4%B8%93%E7%94%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%EF%BC%8C%E5%85%B6%E4%BB%BB%E5%8A%A1%E4%B8%BA%E8%BD%AC%E5%8F%91%E5%88%86%E7%BB%84%E3%80%82"><span class="nav-number">1.6.0.4.</span> <span class="nav-text">4、路由器基本结构：具有多个输入端口和输出端口的专用计算机，其任务为转发分组。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF%E5%8D%8F%E8%AE%AE-RIP"><span class="nav-number">1.7.</span> <span class="nav-text">路由信息协议 RIP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="nav-number">1.7.0.1.</span> <span class="nav-text">1、基本工作过程：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E8%B7%AF%E7%94%B1%E6%9D%A1%E7%9B%AE%E6%9B%B4%E6%96%B0%E8%A7%84%E5%88%99-%E6%9D%A1%E7%9B%AE%E5%86%85%E5%AE%B9%E4%B8%BA%EF%BC%9A%E7%9B%AE%E7%9A%84%E7%BD%91%E7%BB%9C-%E8%B7%9D%E7%A6%BB-%E4%B8%8B%E4%B8%80%E8%B7%B3-%EF%BC%9A"><span class="nav-number">1.7.0.2.</span> <span class="nav-text">2、路由条目更新规则(条目内容为：目的网络-距离-下一跳)：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81RIP%E2%80%9C%E5%9D%8F%E6%B6%88%E6%81%AF%E4%BC%A0%E5%BE%97%E6%85%A2%E2%80%9D%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="nav-number">1.7.0.3.</span> <span class="nav-text">3、RIP“坏消息传得慢”问题：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E6%94%BE%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%E5%8D%8F%E8%AE%AE-OSPF"><span class="nav-number">1.8.</span> <span class="nav-text">开放最短路径优先协议 OSPF</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="nav-number">1.8.0.1.</span> <span class="nav-text">1、工作原理：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81OSPF-%E7%9A%84%E5%88%86%E7%BB%84%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="nav-number">1.8.0.2.</span> <span class="nav-text">2、OSPF 的分组类型：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="nav-number">1.8.0.3.</span> <span class="nav-text">3、基本工作过程：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81OSPF-%E5%9C%A8%E5%A4%9A%E7%82%B9%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%9C%E4%B8%AD%E8%B7%AF%E7%94%B1%E5%99%A8%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E7%9A%84%E5%BB%BA%E7%AB%8B%EF%BC%9A"><span class="nav-number">1.8.0.4.</span> <span class="nav-text">4、OSPF 在多点接入网络中路由器邻居关系的建立：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81%E4%B8%BA%E4%BA%86%E4%BD%BF-OSPF-%E8%83%BD%E5%A4%9F%E7%94%A8%E4%BA%8E%E8%A7%84%E6%A8%A1%E5%BE%88%E5%A4%A7%E7%9A%84%E7%BD%91%E7%BB%9C%EF%BC%8COSPF-%E6%8A%8A%E4%B8%80%E4%B8%AA%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F%E5%86%8D%E5%88%92%E5%88%86%E4%B8%BA%E8%8B%A5%E5%B9%B2%E4%B8%AA%E6%9B%B4%E5%B0%8F%E7%9A%84%E8%8C%83%E5%9B%B4%E5%8F%AB%E5%81%9A%E5%8C%BA%E5%9F%9F-Area"><span class="nav-number">1.8.0.5.</span> <span class="nav-text">5、为了使 OSPF 能够用于规模很大的网络，OSPF 把一个自治系统再划分为若干个更小的范围叫做区域(Area)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%B9%E7%95%8C%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE-BGP"><span class="nav-number">1.9.</span> <span class="nav-text">边界网关协议 BGP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="nav-number">1.9.0.1.</span> <span class="nav-text">1、基本工作原理：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81BGP-4-%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%8A%A5%E6%96%87%EF%BC%9A"><span class="nav-number">1.9.0.2.</span> <span class="nav-text">2、BGP-4 的四种报文：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPv4-%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.10.</span> <span class="nav-text">IPv4 数据报的首部格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E9%99%85%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AE-ICMP"><span class="nav-number">1.11.</span> <span class="nav-text">网际控制报文协议 ICMP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81ICMP-%E5%B7%AE%E9%94%99%E6%8A%A5%E6%96%87%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="nav-number">1.11.0.1.</span> <span class="nav-text">1、ICMP 差错报文类型：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E4%B8%8D%E5%BA%94%E5%8F%91%E9%80%81-ICMP-%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%9A"><span class="nav-number">1.11.0.2.</span> <span class="nav-text">2、不应发送 ICMP 差错报告报文的情况：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84-ICMP-%E8%AF%A2%E9%97%AE%E6%8A%A5%E6%96%87%EF%BC%9A"><span class="nav-number">1.11.0.3.</span> <span class="nav-text">3、常见的 ICMP 询问报文：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ICMP-%E5%BA%94%E7%94%A8%EF%BC%9A"><span class="nav-number">1.11.0.4.</span> <span class="nav-text">ICMP 应用：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91-VPN-%E5%92%8C%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2-NAT"><span class="nav-number">1.12.</span> <span class="nav-text">虚拟专用网 VPN 和网络地址转换 NAT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91-VPN-Virtual-Private-Network-%EF%BC%9A"><span class="nav-number">1.12.0.1.</span> <span class="nav-text">1、虚拟专用网 VPN(Virtual Private Network)：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81VPN-%E7%9A%84%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="nav-number">1.12.0.2.</span> <span class="nav-text">2、VPN 的类型：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2-NAT-Network-Address-Translation-%EF%BC%9A"><span class="nav-number">1.12.0.3.</span> <span class="nav-text">3、网络地址转换 NAT(Network Address Translation)：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%AB%AF%E5%8F%A3%E5%8F%B7%E8%BD%AC%E6%8D%A2-NAPT-Network-Address-and-Port-Translation-%EF%BC%9A"><span class="nav-number">1.12.0.4.</span> <span class="nav-text">4、网络地址与端口号转换 NAPT(Network Address and Port Translation)：</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="hakusuri"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">hakusuri</p>
  <div class="site-description" itemprop="description">Hakusuri的个人生活</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hakusuri" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hakusuri" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/244305717?spm_id_from=333.1007.0.0" title="bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;244305717?spm_id_from&#x3D;333.1007.0.0" rel="noopener" target="_blank"><i class="far fa-tv fa-fw"></i>bilibili</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hakusuri</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">123k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">1:52</span>
</div>
  <div class="powered-by">
<!--由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
-->
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("02/02/2025 22:00:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>
        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

  

    </div>

<!--音乐-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>
  <div id="player" class="aplayer aplayer-withlist aplayer-fixed" data-id="7545855392" data-server="tencent" data-type="playlist" data-order="random" data-fixed="true" data-listfolded="true" data-theme="#2D8CF0"></div>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/assets/haru01.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":true}});</script></body>
</html>
